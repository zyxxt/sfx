

## 需求分析

出于公司精品化的需求，但是对于目前前端的开发是达不到公司要求的，从开发到最终上线，前端的效率不算快，对于某些产品线前端的开发效率可能会成为瓶颈。而且公司目前使用的技术栈结构比较复杂，从开发调试到打包上线，没有统一的平台处理，都是各个产品线内部自己实现，特别是`AF`、`AC`这类老产品线，连前端代码的打包都是跟后台代码耦合在一起的，UI完全无法独立。

!> 为了提高前端从开发到部署上线整个过程的效率，解决开发调试过程中遇到共性问题，针对公司内部已经在使用的各类方案，提出以下最急需解决的问题。`sfx`脚手架最终目标即是解决这些问题，提供统一的开发环境。

- **框架代码移植**

自从公司推行精品化后，产品线突然多了很多，但每到一个新产品线时都要重新搭建UI目录，移植UI框架等，这个过程经常出错，特别是对框架代码不熟悉时，会浪费大量的时间

!> 框架移植完后，还需要根据产品线实际情况做一定的修改，没有一定经验框架代码几乎是改不动的

- **前端代码怎么打包**

前端代码打包时主要要考虑的问题如下：

1. 代码合并压缩
2. 线上代码压缩后怎么调试
3. 代码合并策略是什么，哪些代码合并在一起

对于第一个问题，目前公司采用的方案很多，比如`AF`使用`ant`脚本压缩；`AC`使用`php`在UI加载`js`代码时再做合并压缩处理；`VT`使用`sfis`方案是打包时用`grunt-uglify`插件处理

对于第二个问题，**目前公司所有产品线都没有处理**。上线后的代码全是压缩合并后，没有一定经验的人几乎是无法查问题，需要添加`map`文件才可以解决这类问题

![没有map文件无法调试](http://200.200.151.26/blog/wp-content/uploads/2017/06/RTX截图未命名5.png)

对于第三个问题，老产品线比如`AF`、`AC`使用`deps`，需要第添加一个文件，都要添加一个重名的`deps`文件指明它的依赖列表；`sfis`的方式则可以自动分析依赖，但由于它的策略是按照目录结构打包，业务代码需要自己控制不能出现目录则的相互依赖

`AF`、`AC`使用`deps`，每次添加一个新文件都要自己再添加相应的`deps`

    // AdminPage.js
    var Grid = SF.grid.AdminGrid;
    ...

    // page.deps 文件
    name: SF.AdminPage
    SF.grid.AdminGrid

`sfis`按目录打包合并，看下面的例子，`a.js`、`b.js`本身之间完全没有相互依赖，正常应该都是要可以正常加载才对，但是由于`sfis`是按照`mod_aaa/`、`mod_bbb/`这两个目录打包的，导致最终打包后出现循环引用！

    // mod_aaa/a.js
    var moduleB = requre('../mod_bbb/bbb.js);

    // mod_bbb/b.js
    var moduleA = require('../mod_aaa/aaa.js');

!> 对于这几个打包相关问题各个产品线都有自己一套方案，但是却是无法通用，每次新到一个产品线都要先熟悉一下打包，要不连代码都跑不起来

- **代码组织管理**

前端代码结构没有统一标准，有些产品线还是跟后台脚本耦合在一起，后期维护麻烦，根据不同的产品线主要存在以下问题

1. 怎么处理js依赖关系模块化加载
2. UI框架目录结构怎么组织
3. 重复性的第三方代码太多，业务代码跟第三方代码分离

对于第一个问题，`HCI`使用相对比较好的`cmd`模块加载方案，只是打包时自己小心控制循环引用即可，其它还算是比较先进，但是`AF`、`AC`这类老产品就乱成一团，有使用`deps`加载，也有使用`Extjs4`本身的加载功能，完全无法通用

对于第二个问题，UI框架没有统一的标准，代码能跑起来就没人管了，结构不合理导致新手找文件都是一个难题，比如`AC`前端的`js`代码就有**600多个文件**

第三个问题最严重，目前公司所有产品线的前端代码中，第三方库代码都是跟业务代码混合在一起的，而且经常出来有人为了解决某个需要直接就去改第三方代码里的源代码，导致该第三方库完全没法升级。为了使用某个库的新功能又重新引入了一个不同版本的库，比如`Highcharts`，单单`AC`就有三个版本同时存在！

!> 第三方代码跟业务代码的耦合导致代码的维护性差，要从根源上解决这个问题，就必须把代码结构定义好，禁止把第三方代码放在项目内部，第三方代码应该单独维护

- **前端本地调试，跟后台CGI解耦**



- **代码单元测试、自动化测试**


## 预研目标

1. 对比分析`grunt`、`glup`、`webpack`等常用的打包方式，跟目前公司使用的`sfis`对比选择一个更加适合公司产品线打包方案
2. 方便管理业务代码与引入的第三方库代码
3. 集成本地调试功能，使得业务逻辑可以完全独立于后台CGI
4. 集成测试功能，可对核心代码做测试并生成覆盖率分析


## 可行性分析

![生成map](http://200.200.151.26/blog/wp-content/uploads/2017/06/RTX截图未命名4.png)
![调试有map的js文件](http://200.200.151.26/blog/wp-content/uploads/2017/06/QQ五笔截图未命名2.png)
